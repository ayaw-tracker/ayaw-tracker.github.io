<!DOCTYPE html>
<html lang="en" class=""> <!-- Permanently light mode -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Are You Actually Winning?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base body styles for light mode */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray for body */
        }

        /* Container styles */
        .container {
            max-width: 1024px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: #ffffff; /* White for container */
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* Style for the individual player prop rows in the form */
        .player-prop-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmin(120px, 1fr)) auto;
            gap: 0.75rem;
            padding: 0.75rem;
            background-color: #f9fafb; /* Light background for rows */
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            align-items: center;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(-10px);
            animation: slideIn 0.3s ease forwards;
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .player-prop-row.removing {
            animation: slideOut 0.3s ease forwards;
        }

        @keyframes slideOut {
            to {
                opacity: 0;
                transform: translateX(-100%);
            }
        }

        /* Modal specific styles (unchanged, remains light) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            visibility: hidden;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #ffffff; /* Always white for modal content */
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
            text-align: center;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
            border: 1px solid #e5e7eb; /* Subtle border for definition */
            color: #1f2937; /* Default dark text for modal */
        }
        .modal-content h3 {
            color: #1f2937; /* Ensure heading is dark in modal */
        }
        .modal-content p {
            color: #4b5563; /* Ensure paragraph is dark in modal */
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }

        /* Improved input focus states */
        .form-input:focus {
            ring-color: #3b82f6;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Hover effects for buttons */
        .btn-primary {
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        /* Card specific styles for responsiveness */
        .parlay-card-grid {
            display: grid;
            gap: 1.5rem; /* Gap between cards */
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Auto-fit cards, min width 280px */
        }
        .parlay-card {
            background-color: #ffffff; /* White for card */
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Pushes buttons to the bottom */
            border: 1px solid #e5e7eb;
        }

        /* Specific styling for the card summary section */
        .parlay-card-summary {
            cursor: pointer; /* Indicate this part is clickable */
            padding-bottom: 0.75rem;
            margin-bottom: 0.75rem;
            border-bottom: 1px dashed #e5e7eb; /* Separator line */
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* New style for the subtle expand/collapse indicator on cards */
        .parlay-card-summary::after {
            content: '';
            position: absolute;
            right: 0.75rem;
            top: 1rem;
            font-size: 1.2rem;
            color: #6b7280; /* Gray color for icon */
            transition: transform 0.2s ease;
        }

        .parlay-card-summary.expanded::after {
            content: '';
            transform: rotate(180deg);
        }

        .parlay-card-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        .parlay-card-detail strong {
            color: #4b5563; /* Darker gray in light mode */
        }

        .parlay-card-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            justify-content: flex-end;
        }
        .parlay-card-bets ul {
            margin-top: 0.5rem;
            list-style: none;
            padding-left: 0;
        }
        .parlay-card-bets li {
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
            padding-left: 1.25rem;
            position: relative;
        }
        .parlay-card-bets li::before {
            content: 'â€¢';
            color: #6b7280; /* Gray for bullets */
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        /* Hidden class for toggling details */
        .parlay-card-toggle-details.hidden {
            display: none;
        }

        /* --- Custom CSS for the main collapsible section and arrow --- */
        .parlay-section summary {
            list-style: none;
            outline: none;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: font-weight 0.2s ease-in-out;
            touch-action: manipulation;
        }

        .parlay-section summary::-webkit-details-marker {
            display: none;
        }

        .parlay-section summary::marker {
            display: none;
        }

        .parlay-section summary h3 {
            margin-bottom: 0 !important;
            font-weight: 600;
        }

        .parlay-section .arrow {
            display: none;
        }

        .parlay-section summary:hover h3 {
            font-weight: 800;
        }

        /* Styling for the content area that expands/collapses */
        .parlay-section .parlay-content {
            padding-top: 1rem;
            border-top: 1px dashed #e5e7eb; /* A subtle dashed line above the content */
            margin-top: 1rem;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-6 md:p-8 text-gray-800">
    <div class="container">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-2">Are You Actually Winning?</h1>
            <p class="text-gray-600">Track your parlay betting performance honestly</p>
        </header>

        <!-- New Mission Statement Section -->
        <section class="bg-gray-50 p-6 rounded-lg shadow-sm mb-8 text-center">
            <p class="text-gray-700 text-lg font-medium">
                The truth is in the numbers. Let your data tell the story.
            </p>
        </section>

        <!-- Input Form - Now Collapsible and Centered with Hover Effect -->
        <details class="parlay-section bg-white p-6 rounded-lg shadow-sm mb-8">
            <summary class="cursor-pointer flex justify-center items-center text-2xl font-semibold text-gray-700 mb-4">
                <h3>Add New Parlay</h3>
            </summary>
            <div class="parlay-content">
                <form id="parlayForm" class="space-y-6">
                    <!-- Overall Parlay Details -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div>
                            <label for="result" class="block text-sm font-medium text-gray-700 mb-1">Parlay Result</label>
                            <select id="result" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-800">
                                <option value="Win">Win</option>
                                <option value="Loss">Loss</option>
                                <option value="Push">Push</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="playType" class="block text-sm font-medium text-gray-700 mb-1">Payout Type</label>
                            <select id="playType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-800">
                                <option value="Power">Power Play</option>
                                <option value="Flex">Flex Play</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="amountWagered" class="block text-sm font-medium text-gray-700 mb-1">Amount Wagered ($)</label>
                            <input type="text" 
                                   id="amountWagered" 
                                   step="0.01" 
                                   min="0" 
                                   placeholder="0.00" 
                                   class="money-input w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-800">
                        </div>
                        
                        <div class="lg:col-span-1">
                            <label for="amountWonLoss" class="block text-sm font-medium text-gray-700 mb-1">Amount Won/Loss ($)</label>
                            <input type="text" 
                                   id="amountWonLoss" 
                                   step="0.01" 
                                   placeholder="0.00" 
                                   class="money-input w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-800">
                        </div>
                    </div>

                    <!-- Individual Player/Team Bets Section -->
                    <div>
                        <label class="block text-lg font-semibold text-gray-700 mb-3">Individual Player/Team Bets</label>
                        <div id="playerPropInputs" class="space-y-3 mb-4">
                            <!-- Dynamic player prop inputs will be added here -->
                        </div>
                        <button type="button" 
                                id="addPlayerPropBtn" 
                                class="w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-150 ease-in-out">
                            + Add Player/Team Bet
                        </button>
                    </div>

                    <!-- Submit Button -->
                    <div class="flex justify-end">
                        <button type="submit" 
                                id="submitBtn" 
                                class="bg-blue-600 text-white py-2 px-6 rounded-md shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                            Add Parlay Entry
                        </button>
                    </div>
                </form>
            </div>
        </details>

        <!-- Summary Statistics -->
        <section class="bg-blue-50 p-6 rounded-lg shadow-sm mb-8">
            <h2 class="text-2xl font-semibold text-blue-800 mb-4">Summary Statistics</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                <div class="bg-white p-4 rounded-lg">
                    <p class="text-sm text-gray-600 mb-1">Total Wagered</p>
                    <p class="text-2xl font-bold text-gray-800">$<span id="totalWagered">0.00</span></p>
                </div>
                
                <div class="bg-white p-4 rounded-lg">
                    <p class="text-sm text-gray-600 mb-1">Net Profit/Loss</p>
                    <p class="text-2xl font-bold text-gray-800">$<span id="netProfitLoss">0.00</span></p>
                </div>
                
                <div class="bg-white p-4 rounded-lg">
                    <p class="text-sm text-gray-600 mb-1">Total Parlays</p>
                    <p class="text-2xl font-bold text-gray-800"><span id="totalParlays">0</span></p>
                </div>
                
                <div class="bg-white p-4 rounded-lg">
                    <p class="text-sm text-green-600 mb-1">Wins</p>
                    <p class="text-xl font-bold text-green-700"><span id="totalWins">0</span></p>
                </div>
                
                <div class="bg-white p-4 rounded-lg">
                    <p class="text-sm text-red-600 mb-1">Losses</p>
                    <p class="text-xl font-bold text-red-700"><span id="totalLosses">0</span></p>
                </div>
                
                <div class="bg-white p-4 rounded-lg">
                    <p class="text-sm text-yellow-600 mb-1">Pushes</p>
                    <p class="text-xl font-bold text-yellow-700"><span id="totalPushes">0</span></p>
                </div>
            </div>

            <div class="bg-white p-4 rounded-lg mb-6">
                <label for="successPercentageCalc" class="block text-sm font-medium text-gray-700 mb-2">Success Rate</label>
                <div class="flex items-center space-x-3">
                    <select id="successPercentageCalc" 
                                class="px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-blue-800">
                        <option value="parlays">Parlays</option>
                        <option value="props">Individual Props</option>
                    </select>
                    <p class="text-2xl font-bold text-blue-900"><span id="successPercentage">0.00</span>%</p>
                </div>
            </div>

            <div class="text-center">
                <button id="clearAllBtn" 
                                class="bg-red-500 text-white py-2 px-6 rounded-md shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                    Clear All Entries
                </button>
            </div>
        </section>

        <!-- Parlay History - Table for Desktop, Cards for Mobile -->
        <section class="bg-white p-6 rounded-lg shadow-sm">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Parlay History</h2>
            
            <!-- Table View (visible on md screens and up) -->
            <div class="overflow-x-auto hidden md:block">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Result</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Wagered</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Won/Loss</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Individual Bets</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="parlayTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Parlay table entries will be dynamically added here -->
                    </tbody>
                </table>
            </div>

            <!-- Card View (visible on screens smaller than md) -->
            <div id="parlayHistoryContainer" class="parlay-card-grid block md:hidden">
                <!-- Parlay cards will be dynamically added here -->
            </div>

            <div id="noParlaysMessage" class="text-center text-gray-500 py-12 hidden">
                <p class="text-lg">No parlays tracked yet.</p>
                <p class="text-sm">Add your first parlay above to get started!</p>
            </div>
        </section>
    </div>

    <!-- Welcome Modal -->
    <div id="welcomeModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Welcome to AYAW!</h3>
            <p class="text-gray-700 mb-6">
                This simple tracker helps you <strong>honestly monitor your parlay betting performance</strong> over time.
                Enter your parlay details, including individual prop outcomes, and see your overall profit/loss and success rate.
                All data is saved directly in your browser, so it's always there for you!
            </p>
            <div class="text-center">
                <button id="closeModalBtn" 
                                class="bg-blue-600 text-white py-2 px-6 rounded-md shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                    Got It!
                </button>
            </div>
        </div>
    </div>

    <script>
    // Parlay Tracker Application
    class ParlayTracker {
        constructor() {
            this.parlays = [];
            this.currentSuccessCalcMethod = 'parlays';
            this.editingIndex = -1;
            
            // --- UNDO PROPERTIES ADDED --- //
            this.undoStack = [];
            this.MAX_UNDO_HISTORY = 10;

            this.initializeElements();
            this.attachEventListeners();
            this.loadData();
            this.initializeUI();
        }

        // Initialize DOM element references
        initializeElements() {
            // Form elements
            this.parlayForm = document.getElementById('parlayForm');
            this.resultInput = document.getElementById('result');
            this.playTypeInput = document.getElementById('playType');
            this.amountWageredInput = document.getElementById('amountWagered');
            this.amountWonLossInput = document.getElementById('amountWonLoss');
            this.playerPropInputsContainer = document.getElementById('playerPropInputs');
            this.addPlayerPropBtn = document.getElementById('addPlayerPropBtn');
            this.submitBtn = document.getElementById('submitBtn');
            this.clearAllBtn = document.getElementById('clearAllBtn');

            // Table and Card elements
            this.parlayTableBody = document.getElementById('parlayTableBody');
            this.parlayHistoryContainer = document.getElementById('parlayHistoryContainer');
            this.noParlaysMessage = document.getElementById('noParlaysMessage');

            // Summary elements
            this.totalWageredSpan = document.getElementById('totalWagered');
            this.netProfitLossSpan = document.getElementById('netProfitLoss');
            this.totalWinsSpan = document.getElementById('totalWins');
            this.totalLossesSpan = document.getElementById('totalLosses');
            this.totalPushesSpan = document.getElementById('totalPushes');
            this.totalParlaysSpan = document.getElementById('totalParlays');
            this.successPercentageCalcSelect = document.getElementById('successPercentageCalc');
            this.successPercentageSpan = document.getElementById('successPercentage');

            // Modal elements
            this.welcomeModal = document.getElementById('welcomeModal');
            this.closeModalBtn = document.getElementById('closeModalBtn');

            // Dark Mode Elements (Removed - no longer needed)
            this.htmlElement = document.documentElement; // Still need reference for initial class removal
            // this.darkModeToggle = document.getElementById('darkModeToggle'); // Removed
            // this.sunIcon = document.getElementById('sunIcon'); // Removed
            // this.moonIcon = document.getElementById('moonIcon'); // Removed
        }

        // Attach all event listeners
        attachEventListeners() {
            this.amountWageredInput.addEventListener('focus', this.handleInputFocus.bind(this));
            this.amountWonLossInput.addEventListener('focus', this.handleInputFocus.bind(this));
            this.amountWageredInput.addEventListener('input', this.sanitizeMoneyInput.bind(this));
            this.amountWageredInput.addEventListener('blur', this.formatCurrencyOnBlur.bind(this));
            this.amountWonLossInput.addEventListener('input', this.sanitizeMoneyInput.bind(this));
            this.amountWonLossInput.addEventListener('blur', this.formatCurrencyOnBlur.bind(this));
            this.resultInput.addEventListener('change', (event) => this.updateWonLossBasedOnResult(event));
            this.amountWageredInput.addEventListener('input', (event) => this.updateWonLossBasedOnResult(event));
            this.parlayForm.addEventListener('submit', this.handleFormSubmit.bind(this));
            this.addPlayerPropBtn.addEventListener('click', () => this.addPlayerPropRow());
            this.clearAllBtn.addEventListener('click', this.clearAllParlays.bind(this));
            this.successPercentageCalcSelect.addEventListener('change', this.handleSuccessCalcChange.bind(this));
            this.closeModalBtn.addEventListener('click', this.closeWelcomeModal.bind(this));
            
            // --- KEYBOARD EVENT LISTENER ADDED --- //
            document.addEventListener('keydown', this.handleKeyboardShortcuts.bind(this));

            // Dark Mode Toggle Listener (Removed)
            // this.darkModeToggle.addEventListener('click', this.toggleDarkMode.bind(this));
        }

        // Data persistence methods
        loadData() {
            try {
                const storedParlays = localStorage.getItem('parlays');
                if (storedParlays) {
                    this.parlays = JSON.parse(storedParlays);
                }
                const storedCalcMethod = localStorage.getItem('successCalcMethod');
                if (storedCalcMethod) {
                    this.currentSuccessCalcMethod = storedCalcMethod;
                    this.successPercentageCalcSelect.value = storedCalcMethod;
                }
            } catch (error) {
                console.error("Error loading data from localStorage:", error);
                this.parlays = [];
            }
        }

        saveData() {
            try {
                localStorage.setItem('parlays', JSON.stringify(this.parlays));
                localStorage.setItem('successCalcMethod', this.currentSuccessCalcMethod);
            } catch (error) {
                console.error("Error saving data to localStorage:", error);
            }
        }

        // --- saveStateForUndo() METHOD ADDED --- //
        saveStateForUndo() {
            const currentState = {
                parlays: JSON.parse(JSON.stringify(this.parlays)),
            };
            this.undoStack.push(currentState);
            if (this.undoStack.length > this.MAX_UNDO_HISTORY) {
                this.undoStack.shift();
            }
            console.log(`State saved for undo. Stack size: ${this.undoStack.length}`);
        }

        // Input handling methods
        handleInputFocus(event) {
            if (event.target.value === '0.00') {
                event.target.select();
            }
        }

        sanitizeMoneyInput(event) {
            const input = event.target;
            const originalValue = input.value;
            const originalSelectionStart = input.selectionStart;
            let cleanedValue = '';
            let hasDecimal = false;
            let hasNegative = false;
            let charsRemovedBeforeCursor = 0;

            for (let i = 0; i < originalValue.length; i++) {
                const char = originalValue[i];
                if (input.id === 'amountWonLoss' && char === '-' && i === 0 && !hasNegative) {
                    cleanedValue += char;
                    hasNegative = true;
                } else if (char === '.' && !hasDecimal) {
                    cleanedValue += char;
                    hasDecimal = true;
                } else if (/\d/.test(char)) {
                    cleanedValue += char;
                } else {
                    if (i < originalSelectionStart) {
                        charsRemovedBeforeCursor++;
                    }
                }
            }
            if (cleanedValue.length > 1 && cleanedValue[0] === '0' && cleanedValue[1] !== '.') {
                cleanedValue = cleanedValue.substring(1);
                if (originalSelectionStart > 0 && originalValue[0] === '0') {
                    charsRemovedBeforeCursor++;
                }
            }
            if (originalValue !== cleanedValue) {
                input.value = cleanedValue;
                let newSelectionStart = originalSelectionStart - charsRemovedBeforeCursor;
                newSelectionStart = Math.max(0, newSelectionStart);
                newSelectionStart = Math.min(newSelectionStart, cleanedValue.length);
                input.setSelectionRange(newSelectionStart, newSelectionStart);
            }
        }

        formatCurrencyOnBlur(event) {
            const input = event.target;
            const value = input.value.trim();
            if (value === '') {
                input.value = '';
                return;
            }
            const numericValue = parseFloat(value.replace(/[^0-9.-]/g, ''));
            if (isNaN(numericValue)) {
                input.value = '';
                return;
            }
            input.value = numericValue.toFixed(2);
        }

        updateWonLossBasedOnResult(event) {
            const parlayResult = this.resultInput.value;
            const wageredValue = parseFloat(this.amountWageredInput.value || '0');
            const wonLossInput = this.amountWonLossInput;
            
            if (parlayResult === 'Win') {
                wonLossInput.value = '';
            } else if (parlayResult === 'Loss') {
                wonLossInput.value = (-wageredValue).toFixed(2);
            } else if (parlayResult === 'Push') {
                wonLossInput.value = '0.00';
            }
        }

        // Player prop management
        addPlayerPropRow(player = '', prop = '', result = 'Win') {
            const div = document.createElement('div');
            div.className = 'player-prop-row';
            div.innerHTML = `
                <div>
                    <label class="block text-xs font-medium text-gray-600 mb-0.5">Player/Team</label>
                    <input type="text" placeholder="e.g., Lakers" class="player-name mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm bg-white text-gray-800" value="${player}" required>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-600 mb-0.5">Prop Type</label>
                    <input type="text" placeholder="e.g., Over 25.5 Pts" class="prop-type mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white text-gray-800" value="${prop}" required>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-600 mb-0.5">Result</label>
                    <select class="prop-result mt-1 block w-full px-2 py-1.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white text-gray-800">
                        <option value="Win" ${result === 'Win' ? 'selected' : ''}>Win</option>
                        <option value="Loss" ${result === 'Loss' ? 'selected' : ''}>Loss</option>
                        <option value="Push" ${result === 'Push' ? 'selected' : ''}>Push</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button type="button" class="remove-prop-btn bg-gray-200 text-gray-700 w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-300 transition-all duration-200">-</button>
                </div>
            `;
            this.playerPropInputsContainer.appendChild(div);

            div.querySelector('.remove-prop-btn').addEventListener('click', () => {
                div.classList.add('removing');
                div.addEventListener('animationend', () => div.remove());
            });
        }
        
        // --- handleKeyboardShortcuts() METHOD ADDED --- //
        handleKeyboardShortcuts(event) {
            if ((event.ctrlKey || event.metaKey) && event.key === 'z') {
                event.preventDefault();
                this.undoLastAction();
            }
        }
        
        // --- undoLastAction() METHOD ADDED --- //
        undoLastAction() {
            if (this.undoStack.length === 0) {
                console.log("Nothing to undo.");
                // You could add a small, non-disruptive notification here
                return;
            }
            const lastState = this.undoStack.pop();
            this.parlays = lastState.parlays;
            console.log("Undo action performed. Restoring previous state.");
            this.saveData();
            this.renderAll();
        }

        // --------- CORE LOGIC (RESTORED) --------- //

        initializeUI() {
            this.addPlayerPropRow(); // Start with one empty prop row
            this.renderAll();
            this.showWelcomeModal();
            // No need to call applySavedTheme or updateDarkModeIcon anymore
        }

        showWelcomeModal() {
            // Check if the user has seen the welcome modal before
            if (!localStorage.getItem('hasSeenWelcomeModal')) {
                this.welcomeModal.classList.remove('hidden');
                setTimeout(() => {
                    this.welcomeModal.classList.add('show');
                }, 10); // Small delay to allow CSS transition
            }
        }

        closeWelcomeModal() {
            this.welcomeModal.classList.remove('show');
            this.welcomeModal.addEventListener('transitionend', () => {
                this.welcomeModal.classList.add('hidden');
            }, { once: true }); // Ensure the event listener is removed after one use
            localStorage.setItem('hasSeenWelcomeModal', 'true');
        }

        // Dark Mode Logic (Removed)
        // toggleDarkMode() {}
        // applySavedTheme() {}
        // updateDarkModeIcon() {}

        handleFormSubmit(event) {
            event.preventDefault(); // Prevent default form submission

            this.saveStateForUndo(); // Save current state before modification

            const parlay = this.getFormData();

            if (this.editingIndex === -1) {
                // Add new parlay
                this.parlays.push(parlay);
            } else {
                // Update existing parlay
                this.parlays[this.editingIndex] = parlay;
                this.editingIndex = -1; // Reset editing state
                this.submitBtn.textContent = 'Add Parlay Entry';
            }

            this.saveData();
            this.renderAll();
            this.resetForm();
        }

        getFormData() {
            const result = this.resultInput.value;
            const playType = this.playTypeInput.value;
            const amountWagered = parseFloat(this.amountWageredInput.value || '0');
            let amountWonLoss = parseFloat(this.amountWonLossInput.value || '0');

            // Adjust won/loss based on result if it's a win and amountWonLoss is not set by user
            if (result === 'Win' && amountWonLoss === 0 && amountWagered > 0) {
                // If it's a win, and wonLoss is 0, it should be a positive amount.
                // This assumes the user might leave it blank, and we calculate it.
                // However, the input is required, so we primarily rely on user input.
                // This logic might need refinement based on exact payout calculations.
            }

            const individualBets = [];
            this.playerPropInputsContainer.querySelectorAll('.player-prop-row').forEach(row => {
                const player = row.querySelector('.player-name').value;
                const prop = row.querySelector('.prop-type').value;
                const propResult = row.querySelector('.prop-result').value;
                if (player && prop) { // Only add if player and prop type are filled
                    individualBets.push({ player, prop, result: propResult });
                }
            });

            return {
                id: Date.now(), // Unique ID for each parlay
                date: new Date().toISOString().split('T')[0], //YYYY-MM-DD
                result,
                playType,
                amountWagered: amountWagered.toFixed(2),
                amountWonLoss: amountWonLoss.toFixed(2),
                individualBets
            };
        }

        resetForm() {
            this.parlayForm.reset();
            this.amountWageredInput.value = ''; // Clear actual value
            this.amountWonLossInput.value = ''; // Clear actual value
            this.playerPropInputsContainer.innerHTML = ''; // Clear existing prop rows
            this.addPlayerPropRow(); // Add one fresh prop row
            // Collapse the "Add New Parlay" section after submission
            document.querySelector('.parlay-section').removeAttribute('open');
        }

        renderAll() {
            this.renderSummary();
            this.renderHistory();
        }

        renderSummary() {
            let totalWagered = 0;
            let netProfitLoss = 0;
            let totalWins = 0;
            let totalLosses = 0;
            let totalPushes = 0;
            let totalProps = 0;
            let totalPropWins = 0;

            this.parlays.forEach(parlay => {
                totalWagered += parseFloat(parlay.amountWagered);
                netProfitLoss += parseFloat(parlay.amountWonLoss);

                if (parlay.result === 'Win') {
                    totalWins++;
                } else if (parlay.result === 'Loss') {
                    totalLosses++;
                } else if (parlay.result === 'Push') {
                    totalPushes++;
                }

                parlay.individualBets.forEach(bet => {
                    totalProps++;
                    if (bet.result === 'Win') {
                        totalPropWins++;
                    }
                });
            });

            this.totalWageredSpan.textContent = totalWagered.toFixed(2);
            this.netProfitLossSpan.textContent = netProfitLoss.toFixed(2);
            // This color is dynamically set based on value, so it should apply to both themes
            this.netProfitLossSpan.style.color = netProfitLoss >= 0 ? '#10B981' : '#EF4444'; 

            this.totalWinsSpan.textContent = totalWins;
            this.totalLossesSpan.textContent = totalLosses;
            this.totalPushesSpan.textContent = totalPushes;
            this.totalParlaysSpan.textContent = this.parlays.length;

            this.calculateAndDisplaySuccessPercentage(totalWins, totalParlays, totalPropWins, totalProps);

            this.noParlaysMessage.classList.toggle('hidden', this.parlays.length > 0);
        }

        handleSuccessCalcChange() {
            this.currentSuccessCalcMethod = this.successPercentageCalcSelect.value;
            this.renderSummary(); // Recalculate and display based on new method
            this.saveData(); // Save the user's preference
        }

        calculateAndDisplaySuccessPercentage(totalWins, totalParlays, totalPropWins, totalProps) {
            let successPercentage = 0;
            if (this.currentSuccessCalcMethod === 'parlays') {
                if (totalParlays > 0) {
                    successPercentage = (totalWins / totalParlays) * 100;
                }
            } else if (this.currentSuccessCalcMethod === 'props') {
                if (totalProps > 0) {
                    successPercentage = (totalPropWins / totalProps) * 100;
                }
            }
            this.successPercentageSpan.textContent = successPercentage.toFixed(2);
        }

        renderHistory() {
            this.parlayTableBody.innerHTML = ''; // Clear table
            this.parlayHistoryContainer.innerHTML = ''; // Clear cards

            this.parlays.forEach((parlay, index) => {
                // Render for table view
                const tableRow = this.createTableRow(parlay, index);
                this.parlayTableBody.appendChild(tableRow);

                // Render for card view
                const card = this.createCard(parlay, index);
                this.parlayHistoryContainer.appendChild(card);
            });
        }

        createTableRow(parlay, index) {
            const tr = document.createElement('tr');
            tr.className = 'bg-white'; /* Light background for table rows */
            tr.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${parlay.date}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${parlay.result === 'Win' ? 'text-green-600' : parlay.result === 'Loss' ? 'text-red-600' : 'text-yellow-600'}">${parlay.result}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${parlay.playType}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">$${parseFloat(parlay.amountWagered).toFixed(2)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${parseFloat(parlay.amountWonLoss) >= 0 ? 'text-green-600' : 'text-red-600'}">$${parseFloat(parlay.amountWonLoss).toFixed(2)}</td>
                <td class="px-6 py-4 text-sm text-gray-500">
                    <ul class="list-disc list-inside space-y-1">
                        ${parlay.individualBets.map(bet => `<li>${bet.player}: ${bet.prop} (<span class="${bet.result === 'Win' ? 'text-green-600' : bet.result === 'Loss' ? 'text-red-600' : 'text-yellow-600'}">${bet.result}</span>)</li>`).join('')}
                    </ul>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button data-index="${index}" class="edit-btn text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                    <button data-index="${index}" class="delete-btn text-red-600 hover:text-red-900">Delete</button>
                </td>
            `;

            tr.querySelector('.edit-btn').addEventListener('click', (e) => this.editParlay(index));
            tr.querySelector('.delete-btn').addEventListener('click', (e) => this.deleteParlay(index));
            return tr;
        }

        createCard(parlay, index) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'parlay-card'; 
            cardDiv.innerHTML = `
                <div class="parlay-card-summary">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">${parlay.date} - ${parlay.playType}</h3>
                    <div class="parlay-card-detail">
                        <span>Result:</span>
                        <span class="font-bold ${parlay.result === 'Win' ? 'text-green-600' : parlay.result === 'Loss' ? 'text-red-600' : 'text-yellow-600'}">${parlay.result}</span>
                    </div>
                    <div class="parlay-card-detail">
                        <span>Wagered:</span>
                        <span class="font-bold text-gray-700">$${parseFloat(parlay.amountWagered).toFixed(2)}</span>
                    </div>
                    <div class="parlay-card-detail">
                        <span>Won/Loss:</span>
                        <span class="font-bold ${parseFloat(parlay.amountWonLoss) >= 0 ? 'text-green-600' : 'text-red-600'}">$${parseFloat(parlay.amountWonLoss).toFixed(2)}</span>
                    </div>
                </div>
                <div class="parlay-card-toggle-details hidden">
                    <p class="text-sm font-medium text-gray-700 mb-2 mt-2">Individual Bets:</p>
                    <ul class="parlay-card-bets">
                        ${parlay.individualBets.map(bet => `<li>${bet.player}: ${bet.prop} (<span class="${bet.result === 'Win' ? 'text-green-600' : bet.result === 'Loss' ? 'text-red-600' : 'text-yellow-600'}">${bet.result}</span>)</li>`).join('')}
                    </ul>
                </div>
                <div class="parlay-card-actions">
                    <button data-index="${index}" class="edit-btn bg-blue-500 text-white py-1.5 px-4 rounded-md hover:bg-blue-600 transition-colors">Edit</button>
                    <button data-index="${index}" class="delete-btn bg-red-500 text-white py-1.5 px-4 rounded-md hover:bg-red-600 transition-colors">Delete</button>
                </div>
            `;
            cardDiv.querySelector('.parlay-card-summary').addEventListener('click', () => {
                const details = cardDiv.querySelector('.parlay-card-toggle-details');
                details.classList.toggle('hidden');
                cardDiv.querySelector('.parlay-card-summary').classList.toggle('expanded');
            });
            cardDiv.querySelector('.edit-btn').addEventListener('click', () => this.editParlay(index));
            cardDiv.querySelector('.delete-btn').addEventListener('click', () => this.deleteParlay(index));
            return cardDiv;
        }

        editParlay(index) {
            this.saveStateForUndo(); // Save current state before editing

            const parlayToEdit = this.parlays[index];
            if (parlayToEdit) {
                this.resultInput.value = parlayToEdit.result;
                this.playTypeInput.value = parlayToEdit.playType;
                this.amountWageredInput.value = parseFloat(parlayToEdit.amountWagered).toFixed(2);
                this.amountWonLossInput.value = parseFloat(parlayToEdit.amountWonLoss).toFixed(2);

                this.playerPropInputsContainer.innerHTML = ''; // Clear current prop rows
                parlayToEdit.individualBets.forEach(bet => {
                    this.addPlayerPropRow(bet.player, bet.prop, bet.result);
                });

                this.editingIndex = index;
                this.submitBtn.textContent = 'Update Parlay Entry';
                // Open the form section if it's collapsed
                document.querySelector('.parlay-section').setAttribute('open', '');
                this.parlayForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        deleteParlay(index) {
            // Confirmation modal would be here instead of alert/confirm
            // For now, let's proceed with deletion for demonstration
            this.saveStateForUndo(); // Save current state before deletion
            this.parlays.splice(index, 1);
            this.saveData();
            this.renderAll();
            this.resetForm(); // Reset form in case we were editing the deleted item
        }

        clearAllParlays() {
            // Use a custom modal for confirmation
            this.showCustomConfirmation(
                "Are you sure?",
                "This action will permanently delete ALL your parlay entries.",
                () => { // On confirm
                    this.saveStateForUndo(); // Save state before clearing
                    this.parlays = [];
                    this.saveData();
                    this.renderAll();
                    this.resetForm();
                    console.log("All parlays cleared.");
                },
                () => { // On cancel
                    console.log("Clear all cancelled.");
                }
            );
        }

        // Custom Modal for confirmations (replaces alert/confirm)
        showCustomConfirmation(title, message, onConfirm, onCancel) {
            // Create modal elements if they don't exist
            let customModal = document.getElementById('customConfirmationModal');
            if (!customModal) {
                customModal = document.createElement('div');
                customModal.id = 'customConfirmationModal';
                customModal.className = 'modal-overlay hidden';
                customModal.innerHTML = `
                    <div class="modal-content">
                        <h3 class="text-xl font-bold text-gray-800 mb-4" id="customModalTitle"></h3>
                        <p class="text-gray-700 mb-6" id="customModalMessage"></p>
                        <div class="flex justify-center space-x-4">
                            <button id="customModalCancel" class="bg-gray-300 text-gray-800 py-2 px-6 rounded-md shadow-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition duration-150 ease-in-out">Cancel</button>
                            <button id="customModalConfirm" class="bg-red-600 text-white py-2 px-6 rounded-md shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition duration-150 ease-in-out">Confirm</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(customModal);
            }

            // Populate modal content
            document.getElementById('customModalTitle').textContent = title;
            document.getElementById('customModalMessage').textContent = message;

            // Show modal
            customModal.classList.remove('hidden');
            setTimeout(() => customModal.classList.add('show'), 10);

            // Add event listeners for buttons
            const confirmBtn = document.getElementById('customModalConfirm');
            const cancelBtn = document.getElementById('customModalCancel');

            // Ensure previous listeners are removed to prevent multiple calls
            const oldConfirmHandler = confirmBtn.onclick;
            const oldCancelHandler = cancelBtn.onclick;
            if (oldConfirmHandler) confirmBtn.removeEventListener('click', oldConfirmHandler);
            if (oldCancelHandler) cancelBtn.removeEventListener('click', oldCancelHandler);


            const handleConfirm = () => {
                onConfirm();
                hideModal();
            };
            const handleCancel = () => {
                onCancel();
                hideModal();
            };

            confirmBtn.addEventListener('click', handleConfirm, { once: true });
            cancelBtn.addEventListener('click', handleCancel, { once: true });

            const hideModal = () => {
                customModal.classList.remove('show');
                customModal.addEventListener('transitionend', () => {
                    customModal.classList.add('hidden');
                }, { once: true });
            };
        }
    }

    // Initialize the tracker when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        // Ensure the html element starts without 'dark' class for default light mode
        document.documentElement.classList.remove('dark');
        new ParlayTracker();
    });
    </script>
</body>
</html>
